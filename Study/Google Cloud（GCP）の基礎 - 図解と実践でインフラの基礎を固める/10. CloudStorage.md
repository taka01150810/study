# 53. Cloud Storageの概要

## Cloud Storageとは
- GCPの代表的なストレージサービス
- バックエンドのデータ保存に利用（画像ファイル、JSON、ZIPなど様々なオブジェクトを保存可能）
- バケツ（Bucket）という単位でデータを格納

## データの保存場所
- リージョン（例：東京リージョン）を選択し、その場所に保存
- デュアルリージョンやマルチリージョンも選択可能
  - 複数リージョンに非同期で冗長的に保存
  - 地理的に離れた場所に保存し耐障害性を確保

## 耐久性
- 非常に高い耐久性（11ナイン：99.999999999%）
- 例：10億個のオブジェクトが100年間に1つも失われない確率

## ストレージクラス
- スタンダード：頻繁にアクセスするデータ向け（保存コスト高、取得コスト低）
- ニアライン：月1回程度のアクセス向け（保存コスト安、取得コスト高）
- コールドライン：3ヶ月に1回程度のアクセス向け
- アーカイブライン：年1回程度のアクセス向け（保存コスト最安、取得コスト非常に高い）

## アクセス制御
- 均一アクセス制御（IAMロールで管理）
- ACL（アクセスコントロールリスト）でオブジェクト単位の細かい制御も可能

## バージョニング
- 同一オブジェクトの複数バージョンを保存可能
- バージョニングを有効にすると古いバージョンも保持できるが、ストレージコストが増加

## ライフサイクル管理
- オブジェクトの自動クラス変更や削除ルールを設定可能
- 例：一定期間アクセスのないデータをコールドラインに移動、古いバージョンを削除など

## まとめ
- Cloud Storageは多様なデータ保存に使える汎用的なオブジェクトストレージ
- 高い耐久性と柔軟な保存オプションを備えている
- ストレージクラスやライフサイクル管理によりコスト最適化が可能

# 54. Cloud Storageのバケット作成

## Cloud Storageコンソールの概要
- クラウドストレージの管理画面でバケット一覧を確認可能
- バケットのリージョンタイプ（リージョン・マルチリージョン・デュアルリージョン）、ストレージクラス（スタンダード等）、アクセス設定、ライフサイクル管理の有無、暗号化設定を確認できる
- 暗号化はデフォルトでGoogle管理の鍵を使用。顧客管理の鍵も選択可能

## バケット作成のポイント
- バケット名はグローバルでユニーク（重複不可）
- データ保管場所は「リージョン」「マルチリージョン」「デュアルリージョン」から選択
  - デュアルリージョンは決まった2つのリージョンに保存（例：東京と大阪）
  - TURBOレプリケーションを選ぶと非同期レプリケーションの速度が向上（15分以内を目標）

## ストレージクラス選択と料金
- スタンダード、ニアライン、コールドライン、アーカイブから選択
- ストレージの保存コストはクラスごとに異なり、アーカイブが最も安い
- 取得（データ読み出し）コストは逆にアーカイブが最も高い
- 地域（リージョン）によって料金も変動する
- 大容量の場合（例：100TB）では料金差が大きくなるため見積もりが重要

## アクセス制御
- デフォルトはIAMによる均一アクセス制御（バケットレベル）
- オブジェクト単位のACL管理も可能だが、均一制御が推奨されている
- 公開アクセス禁止などのセキュリティ設定も可能

## その他の設定
- バージョニング（オブジェクトの複数バージョン管理）を有効化可能
- 顧客管理の暗号化鍵設定も選択可能
- 操作に対しても小額の課金（API操作ごと）が発生する

## ファイルアップロードと管理
- ファイルやフォルダをバケットにアップロード可能（ドラッグ＆ドロップ対応）
- アップロードしたファイルは種類ごとに自動判定（例：PNGは画像ファイルとして認識）
- ブラウザから直接ダウンロード・プレビュー可能

---

バケットを作成し、適切なリージョン・ストレージクラス・アクセス制御を設定することで、コストとセキュリティを管理しつつクラウドストレージを活用できる。

# 55. gsutilコマンド

## gsutilとは
- Google Cloudの操作に使うCLIツールの一つで、Cloud Storage専用のコマンドラインアプリケーション
- Pythonで実装されており、Python3が必要（Pythonバージョン3以降推奨）
- Linux、macOS、Windowsで動作可能
- GCPのCloud Shellでは初めからインストール済みで利用可能
- ローカルPCで使う場合はSDKのインストールが必要

## gsutilでできること
- バケットの作成・削除
- オブジェクト（ファイル）のアップロード・ダウンロード
- バケット内のオブジェクト一覧表示
- オブジェクトの移動・コピー・名前変更
- アクセスコントロール設定（ACLなど）
- UIを使わず一括バッチ処理が可能で効率的

## コマンド例
- `gsutil ls gs://bucket-name`  
  → バケット内のオブジェクト一覧を表示
- `gsutil mv gs://bucket-name/oldname.png gs://bucket-name/newname.png`  
  → オブジェクトの名前変更や移動
- `gsutil mb -l asia-northeast1 gs://unique-bucket-name`  
  → 新しいバケットを東京リージョンに作成（バケット名はグローバルでユニークが必須）
- `gsutil cp /local/path/file.png gs://bucket-name/`  
  → ローカルファイルをバケットにコピー（アップロード）

## 注意点
- ローカルPCのファイルをアップロードするときは、そのコマンドはローカル端末上で実行する必要がある（Cloud Shell内ではローカルファイルは見えない）
- バケット削除には2種類のコマンドがある
  - `gsutil rb gs://bucket-name`：空のバケットのみ削除可能
  - `gsutil -m rm -r gs://bucket-name`：バケット内のオブジェクトを全削除してバケットも削除（中身がある場合はこちらを使用）

## まとめ
- gsutilはCloud Storageの管理に特化した強力なCLIツール
- GUIよりも高速・効率的に操作ができるため、大量のファイル操作や自動化に適している
- Cloud Shellでは事前に使えるが、ローカルで使うにはSDKのインストールと設定が必要

# 小テスト10: CloudStorage

Cloud Storageに関する理解度を確認するための小テストです。

- バケットとは何か？
- バケット名の命名ルール（グローバルでユニークである必要性）
- ストレージクラス（スタンダード、ニアライン、コールドライン、アーカイブ）の違いと特徴
- リージョンタイプ（単一リージョン、マルチリージョン、デュアルリージョン）の違い
- バケットのアクセス制御方式（IAMベースの均一アクセス制御 vs ACL）
- バージョニング機能の目的と利用シーン
- バケットやオブジェクトの暗号化オプション（Google管理鍵、顧客管理鍵）
- gsutilコマンドの基本操作（バケット作成、削除、ファイルのアップロード・ダウンロード）
- バケット削除時の注意点（空のバケットのみ削除可能なことや、中身を含めて削除する方法）

---

このテストでCloud Storageの基本的な概念や操作方法、料金体系の理解度を確認しましょう。
