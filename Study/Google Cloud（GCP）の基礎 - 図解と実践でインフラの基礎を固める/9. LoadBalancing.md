# 52. Cloud Load Balancingの概要

## ロードバランサーとは
- ロードバランサーは「負荷分散」の仕組み。
- 多数のユーザーからのトラフィックを複数のサーバー（バックエンド）に分散して処理負荷を軽減し、可用性を高める。
- 1台のサーバーに負荷が集中すると障害時にサービス停止するため、複数のインスタンスを用意しロードバランサーで振り分ける。

## バックエンド構成例
- バックエンドにはWebサーバー、アプリケーションサーバー、インスタンスグループなどがある。
- コンテンツや画像、データベースもバックエンドとして配置可能。

## 負荷分散のタイプ
- **レイヤー7（アプリケーション層）負荷分散**  
  HTTP/HTTPSプロトコルを利用した負荷分散。Webアプリ向け。  
- **レイヤー4（トランスポート層）負荷分散**  
  TCP/UDP/IPプロトコルを利用した負荷分散。より低レベルの通信単位で処理。

## グローバル vs 内部（インターナル）負荷分散
- グローバルロードバランサーは世界中のユーザーに対応。  
- 内部ロードバランサーはクラウド内部ネットワークでの負荷分散。

## ロードバランサーの主な機能
- **自動スケーリング**：トラフィック増加時にインスタンス数を自動調整。  
- **SSLオフロード**：ロードバランサー側で暗号化通信の復号処理を行い、バックエンドの負荷軽減。  
- **ヘルスチェック**：バックエンドの正常稼働を監視し、障害があればトラフィック配信対象から外す。  
- **セッションアフィニティ**：同一ユーザーのリクエストを同じバックエンドに送ることでセッション維持を実現。  
- **クラウドCDNとの統合**：キャッシュを利用してバックエンド負荷を軽減し高速配信。  

## エニーキャスト技術
- 世界各地のGoogleフロントエンドでユーザーのリクエストを受け、高速かつ安全なGoogleバックボーンネットワークを経由してサービス提供。

## ロードバランサーの種類と選択
- 多数の種類があり、用途に応じて使い分ける。  
- グローバル／リージョナル、レイヤー4／レイヤー7、内部／外部など複数パターン。  
- 選択のための決定木（ディシジョンツリー）が用意されている。

## 対応可能なバックエンド例
- Compute Engineインスタンス、インスタンスグループ  
- Kubernetes Engine、Cloud Run、App Engine、Cloud Functions など多様

## まとめ
- ロードバランサーは、単一障害点を排除し負荷を分散してサービスの安定稼働を支える重要な基盤。  
- GCPのクラウドロードバランシングは多彩な機能・種類があり、大規模かつ多様なシステムニーズに対応可能。

---

# 小テスト9: Load Balancing（負荷分散）

1. **ロードバランサーの主な役割は何ですか？**  
   - トラフィックを複数のサーバーに分散し、負荷軽減と可用性向上を図る。

2. **GCPにおけるロードバランサーのサービス名は？**  
   - Cloud Load Balancing（クラウドロードバランシング）

3. **負荷分散のレイヤー7とレイヤー4の違いは？**  
   - レイヤー7：HTTP/HTTPSなどのアプリケーション層で負荷分散を行う。  
   - レイヤー4：TCP/UDPなどのトランスポート層で負荷分散を行う。

4. **ロードバランサーが提供する機能の例を3つ挙げよ。**  
   - 自動スケーリング  
   - SSLオフロード  
   - ヘルスチェック

5. **セッションアフィニティとは何か？**  
   - 同一ユーザーのリクエストを常に同じバックエンドに送る仕組み。

6. **エニーキャスト技術の役割は？**  
   - ユーザーの地理的に近いGoogleフロントエンドへ接続させ、高速かつ安全な通信を実現する。

7. **バックエンドとして使えるGCPのサービスは？（例）**  
   - Compute Engineのインスタンスやインスタンスグループ、Kubernetes Engine、Cloud Run、App Engine、Cloud Functionsなど。

8. **ロードバランサーの種類を選ぶ際に参考にするツールは？**  
   - ディシジョンツリー（決定木）

---
