# 56. Cloud SQLの概要

## 概要
- Cloud SQLはGCPのフルマネージド型リレーショナルデータベースサービス。
- 対応DBはMySQL、PostgreSQL、SQL Serverの3種類（Oracleは非対応）。
- バックアップ、レプリケーション、暗号化、パッチ適用、フェイルオーバーなどの管理をGCPが代行。
- 99.95%の可用性を保証（年間約4時間の停止許容）。
- フェイルオーバー機能でさらなる可用性向上が可能。

## 利用イメージ
- Compute Engine、App Engine、Kubernetes Engine上のアプリケーションのバックエンドとして利用。
- Cloud SQLインスタンスは固定IPアドレスを持ち、VM上でデータベースソフトウェアを実行。
- 永続ディスクにデータを保存。
- フルマネージドによりVMやDBの運用管理をGCPに任せられる。

## 他のDBとの違い
- ノーSQL系（Firebase、Datastore、Bigtable）などと異なり、リレーショナルDBとして広く使われている。
- 自分でCompute EngineにDBを構築・管理することも可能だが、運用負荷が高い。

## 管理ツール
- phpMyAdminやMySQL Workbenchなど、既存の管理ツールも利用可能。

## 料金
- 基本料金は無料枠あり（CPU、メモリ、ストレージ、ネットワーク使用量で課金）。
- SQL Serverはライセンス料金が別途必要。
- 可用性を高めるHA構成ではインスタンスを複数用意するため追加費用発生。
- 固定IPアドレス利用にも料金がかかる。

## 運用・メンテナンス
- GCPがハードウェアのメンテナンス（ライブマイグレーション技術を活用）を実施。
- ソフトウェアのメンテナンス時は再起動が必要な場合があり、スケジュール設定可能。
- バックアップやフェイルオーバー設定により高可用性を実現可能。

---

Cloud SQLは、リレーショナルデータベースの管理負荷を大幅に軽減し、GCP上で安全かつ効率的に利用できるサービスです。

# 57. Cloud SQLインスタンスの作成と設定（MySQL）

## インスタンス作成の流れ
- GCPコンソールの「ストレージ」→「データベース」→「Cloud SQL」から新規インスタンスを作成。
- データベースエンジンはMySQL、PostgreSQL、SQL Serverから選択可能。
- バージョン、リージョン、マシンタイプ（CPU・メモリ）、ストレージ種類（SSD/HDD）を設定。
- 高可用性（マルチゾーン）構成の選択も可能。
- 料金は構成によって大きく変動し、最小構成は月額約1,000円〜。

## ネットワーク設定
- インスタンスはデフォルトでパブリックIPが割り当てられる。
- アクセス制限のため、許可するクライアントのIPアドレスをCIDR形式で登録。
- VPCのプライベートIPも利用可能。
- MySQLの標準ポートは3306番（テキスト中の3366は誤記）。

## 接続テスト
- クライアントPCのグローバルIPを許可リストに追加し、接続可能かテスト。
- 許可がないと「到達不能」となる。

## クライアント接続
- MySQLクライアントソフト（例：MySQL Workbench、Sequel Aceなど）で接続設定。
- ホストにCloud SQLのIPまたは接続名、ユーザーはroot、パスワードを指定。
- ポートは3306を指定。
- SSL接続を有効化し、証明書をクライアントに設定することで通信の暗号化が可能（推奨）。

## データベース操作
- 接続後、データベースの作成、テーブル作成、データ挿入が可能。
- SQLクエリを用いて操作・確認できる。

## その他機能
- バックアップ設定：手動・自動バックアップの指定、バックアップ保存先リージョンの選択。
- リードレプリカ：読み取り専用レプリカを作成し可用性や読み取り負荷分散が可能。
- メトリクス確認：CPU使用率やメモリ使用率などの監視が可能。
- オペレーションログで操作履歴を確認。

## ポイント
- フルマネージドなのでインフラ管理は不要。
- 初期設定時にIP許可リストの設定を忘れずに。
- セキュリティ強化のためSSL接続の利用が推奨。
- MySQL以外にPostgreSQLやSQL Serverも選択可能。

---

Cloud SQLはGCP上で簡単かつ安全にリレーショナルデータベースを構築・運用できる便利なサービスです。

# 58. Datastoreの概要

## Datastoreとは？

Google Cloud の **スケーラブルな NoSQL データベースサービス**。主に Web アプリやモバイルアプリ向けに設計されています。

- **高いスケーラビリティ**
- **グローバルに分散された構造**
- **非リレーショナル（NoSQL）型データベース**
- 書き込みや読み込みの整合性は選択可能（強整合性 / 結果整合性）

---

## NoSQL とリレーショナルDBの違い

| リレーショナルDB         | NoSQL (例: Datastore)       |
|---------------------------|-----------------------------|
| スキーマに厳密            | 柔軟なデータ構造             |
| 強整合性が標準            | 結果整合性も選択可能         |
| 垂直スケーリングに強い    | 水平スケーリングが得意       |
| テーブル・行・列の概念     | 名前空間・カインド・エンティティ・プロパティ |

---