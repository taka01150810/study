# 62. App Engine の概要

## ✅ App Engine とは

- Google Cloud が提供する **フルマネージドのサーバーレス PaaS（Platform as a Service）**
- アプリケーションのインフラ管理を不要にし、**開発に集中**できる
- GCPの中でも**歴史が長いサービス**で、機能が豊富

---

## ✅ IaaS（Compute Engine）との違い

| IaaS（VM）           | PaaS（App Engine）                    |
|----------------------|----------------------------------------|
| ハードウェア管理必要 | Googleがインフラ〜実行環境まで管理   |
| OSやランタイム管理  | コードのみをデプロイすればOK         |
| 柔軟性は高い         | 構築は複雑                            |
| 開発者の責任範囲が広い | 開発者はアプリケーション開発に集中可能 |

---

## ✅ サポートされる言語と環境

- 標準環境（Standard）：Node.js, Python, Java, PHP, Go など
- フレキシブル環境（Flexible）：Dockerコンテナベース、独自ランタイム可
  - 標準環境より起動が遅いが、**柔軟性が高い**
  - コンテナでのカスタム構成が可能

---

## ✅ 主な特徴と機能

- **完全サーバーレス**：インフラの運用管理が不要
- **自動スケーリング**：トラフィックに応じて自動でスケール
- **バージョン管理とトラフィック分割**
- **ユーザー認証**（Cloud Identity 連携）
- **スケジューラ機能（Cronジョブ）**
- **Memcacheによるパフォーマンス改善**
- **セキュリティ：ファイアウォール・脆弱性スキャン**

---

## ✅ App Engine の活用例

- **Webアプリケーションのホスティング**
  - ロードバランサ経由でリクエストを受け、App Engine で処理
  - Cloud Storage や Cloud SQL, Firestore との連携
- **バッチ処理の自動実行**
  - 定期実行タスクを App Engine に配置し、夜間処理などに活用

---

## ✅ 課金体系

- **従量課金制（Pay as you go）**
  - 使用したリソースに応じて課金
  - 小規模なアプリであれば無料枠で動かすことも可能

---

## ✅ 学習／導入支援

- GCP公式の GitHub に多数のサンプルあり（Hello World など）
- 標準／フレックス環境別にサンプルが用意されており、導入が簡単

---

## ✅ まとめ

App Engine は、**アプリ開発に集中できるサーバーレスなプラットフォーム**。  
自動スケーリングやセキュリティ、バージョン管理などの機能が充実しており、特に**Webアプリやバッチ処理の実行基盤として効果的**。


# 63. App Engine：スタンダード環境とフレキシブル環境の違い

Google App Engine では、アプリケーションの実行環境として「スタンダード環境」と「フレキシブル環境」の2種類が用意されています。それぞれの特徴と選択基準を比較します。

---

## ✅ 実行環境の違い

| 項目                     | スタンダード環境                             | フレキシブル環境                             |
|--------------------------|-----------------------------------------------|-----------------------------------------------|
| 実行基盤                 | サンドボックス環境                           | Compute Engine 上の Docker コンテナ           |
| スケーリング速度         | 秒単位で迅速                                 | 分単位でスケーリング                          |
| 起動時間                 | 短い（秒単位）                               | 長め（数分程度）                              |
| スケーリングの種類       | 自動 / 基本 / 手動                           | 自動 / 手動                                   |
| インスタンス0スケール    | 可（インスタンスが0にもなる）               | 不可（最低1つは常駐）                         |
| ローカルディスク         | 言語による制限あり                           | 書き込み可能（VM起動時に初期化される）        |
| リクエストのタイムアウト | 短め（言語や設定に依存）                    | 最大60分                                      |
| SSHアクセス              | 不可                                        | 可能                                          |

---

## ✅ ランタイムと言語サポート

- **スタンダード環境**
  - 対応言語：Python, Java, Go, PHP など（限定されたバージョン）
  - 言語ランタイムは固定（カスタム不可）

- **フレキシブル環境**
  - 対応言語：上記に加え、任意の言語（カスタムランタイム）
  - Dockerコンテナを使用し、独自環境を構築可能

---

## ✅ スケーリング戦略の違い

- **自動スケーリング**：トラフィックやレスポンス時間に応じて自動で調整
- **基本スケーリング（スタンダードのみ）**：リクエスト時に起動、アイドル時は終了
- **手動スケーリング**：固定数のインスタンスを常時稼働

---

## ✅ 費用と課金体系

| 項目                 | スタンダード環境                             | フレキシブル環境                             |
|----------------------|-----------------------------------------------|-----------------------------------------------|
| 課金単位             | インスタンス時間ベース                       | 秒単位（最小1分）                             |
| 無料枠               | あり（小規模アプリは無料で動作可能）       | なし                                          |
| 課金要素             | インスタンス時間、インスタンス数など        | vCPU、メモリ、永続ディスク、ネットワークなど |

---

## ✅ その他の違い

| 項目                             | スタンダード環境             | フレキシブル環境               |
|----------------------------------|------------------------------|-------------------------------|
| WebSocket 利用                   | 不可                         | 可能                          |
| サードパーティバイナリの使用     | 言語により制限あり           | 自由（Docker イメージで管理）|
| ランタイムの変更                 | 不可（後から変更不可）      | Dockerfile によって可能       |
| Cloud SQL, Cloud Storage 連携   | 両環境とも可能               | 両環境とも可能                 |

---

## ✅ 選択の目安

| 選択基準                             | 推奨環境        |
|--------------------------------------|-----------------|
| コストを抑えたい、小規模開発         | スタンダード    |
| 高速スケーリングが必要               | スタンダード    |
| 特定ランタイムに制限がない／独自環境 | フレキシブル    |
| WebSocket やサードパーティ利用        | フレキシブル    |
| 安定したトラフィックが見込まれる     | フレキシブル    |

---

## ✅ 補足：Compute Engine との比較

- フレキシブル環境は内部的に VM（Compute Engine）上で動作
- ただし、App Engine のスケーリング・管理機能は利用可能

---

## ✅ まとめ

| 環境             | 特徴                                                                 |
|------------------|----------------------------------------------------------------------|
| スタンダード環境 | 高速・低コスト・簡易設定向け。無料枠あり、軽量Webアプリ向け。         |
| フレキシブル環境 | 柔軟性・高機能が必要なアプリ向け。カスタムランタイムやDocker対応。    |

App Engine を選ぶ際は、**言語制約・スケーリング要件・料金**を考慮して、最適な環境を選択しましょう。

# 64. スタンダード環境のデプロイ（App Engine）

## 概要
App Engine の **スタンダード環境**での Python アプリケーション（Hello World）を GCP 上にデプロイする手順を解説。

---

## サンプルコードの入手
- GitHub で App Engine の公式サンプルを入手可能。
- ZIP形式でダウンロードし、ローカルに展開。

## フォルダ構成
- `appengine/standard/python3/hello_world/` を使用。
- **使用ファイル**:
  - `main.py`：Flask を使った簡単なWebアプリ。
  - `app.yaml`：App Engine用の設定ファイル（ランタイム指定など）。

## ローカルでの動作確認
1. `Visual Studio Code` などでプロジェクトを開く。
2. `main.py` を変更（例："Hello World 3!" など）。
3. ローカル実行して、ブラウザで動作確認。

## App Engine へのデプロイ手順
1. ターミナルで対象ディレクトリに移動。
2. `gcloud app deploy` を実行。
3. プロンプトに従ってデプロイ（サービス名や確認など）。
4. 数分でデプロイ完了。

## デプロイ後の確認
- GCP コンソールでサービス状況を確認。
- **バージョンの切り替え**:
  - アップデートにより新しいバージョンが作成。
  - トラフィックは最新版に自動で100%割り当て。

## トラフィック分割（A/B テスト）
- トラフィックの割り振り（例：50%ずつ）を設定可能。
- 分割方式:
  - ランダム
  - IPアドレスベース
  - クッキー情報ベース
- 各バージョンのURLも個別に利用可能。

## モダンなデプロイ手法
- **A/Bテスト**：段階的にトラフィックを新バージョンへ。
- **ブルーグリーンデプロイメント**：一気に切り替える方式。
- App Engine を用いることで、**ダウンタイムなしのデプロイ**が可能。

## 学習ポイント
- `app.yaml`でのランタイム定義（例：python39）
- `gcloud app deploy` の使い方
- バージョン管理とトラフィックの動的切替
- サンプルコードを使って試行錯誤することの重要性

---

## 参考リンク
- GitHub App Engine Samples: https://github.com/GoogleCloudPlatform/python-docs-samples

# 65. フレキシブル環境のデプロイ（App Engine）

## 概要
App Engine の **フレキシブル環境**での Python アプリケーション（Hello World）を GCP 上にデプロイする手順と特徴を解説。

---

## スタンダード環境との共通点
- ローカルで開発・動作確認を行う。
- `gcloud app deploy` コマンドでデプロイ。
- GCP上で動作確認・本番運用へ。

---

## サンプルコードの入手と準備
- GitHubのZIPファイルから「appengine/flexible/python/hello_world」を使用。
- Visual Studio Code などでプロジェクトを開く。
- フレキシブル環境では `unicorn` モジュール（WSGIサーバー）を利用。
- `main.py` とその他ファイルでWebアプリを構成。

## ローカル動作確認
- Pythonプログラムをローカル実行（例：ポート8080）。
- ブラウザで「HELLOWORLD」と表示されることを確認。

## `app.yaml` の違い
- スタンダード環境と異なり、
  - `env: flex` が必須（環境がフレキシブルであることを宣言）。
  - `runtime` や `entrypoint`（unicornの起動コマンドなど）、リソース設定（CPU・メモリ）、スケーリング設定など詳細を記述。

## デプロイ手順
1. ターミナルでプロジェクトディレクトリに移動。
2. `gcloud app deploy` を実行。
3. 設定内容を確認し「yes」で承認。
4. デプロイ完了まで約5分（スタンダードより時間がかかる）。

## デプロイ後の確認
- GCP コンソールで新しいバージョンが作成されていることを確認。
- ランタイムは Python、環境はフレキシブルであることが表示される。
- ブラウザでアプリにアクセスし、正常に動作することを確認。

## トラフィック分割
- 複数バージョンに対してトラフィックを分割可能（例：3分割で33%ずつ）。
- 分割設定後、各バージョン専用URLも確認可能。
- デフォルトURLは割り振りによりアクセス先バージョンがランダムに切り替わる。

## まとめ
- スタンダード環境とデプロイコマンドは共通。
- `app.yaml` の書き方やアプリ構成が異なる。
- フレキシブル環境は Docker コンテナベースで、より自由度が高い。
- Java、PHPなど他言語でもフレキシブル環境の特徴を活かした開発が可能。
- それぞれのサンプルを確認しながら開発を進めることが推奨される。

---

# 小テスト14: App Engineの概要

---

## App Engineとは
- Google Cloud PlatformのPaaS（Platform as a Service）
- アプリケーションの自動スケーリング・運用管理が容易
- サーバー管理不要でコードのデプロイに集中可能

## 環境の種類
- **スタンダード環境**
  - 軽量で起動が速い
  - サンドボックス制限あり
  - 主に軽量アプリ向け
- **フレキシブル環境**
  - Dockerコンテナベース
  - カスタマイズ可能で自由度が高い
  - 重い処理やカスタムランタイムに対応

## アプリケーション構成
- サービス（モジュール）
- バージョン（複数バージョンの同時運用が可能）
- インスタンス（バージョン単位で動作）

## デプロイの特徴
- `gcloud app deploy` コマンドで簡単デプロイ
- トラフィック分割やブルーグリーンデプロイも可能
- ダウンタイムなしでバージョン切り替えができる

## メリット
- 運用管理の負担軽減
- 自動スケーリングでコスト最適化
- 簡単なデプロイで迅速なリリース

---
