
# 84. グローバルリソース、リージョンリソース、ゾーンリソース

## 概要
GCPのリソースは世界中に分散されており、アクセスできる範囲（スコープ）によって以下の3種類に分類されます。

### リソースの種類とアクセス範囲
- **グローバルリソース**  
  - 世界中どこからでもアクセス可能  
  - 例：VMイメージ、VMスナップショット、インスタンステンプレート、VPCネットワーク  

- **リージョンリソース**  
  - 指定リージョン内の範囲でアクセス可能  
  - 他リージョンからのアクセスは不可  
  - 例：サブネット、リージョン永続ディスク  

- **ゾーンリソース**  
  - 指定ゾーン内のみアクセス可能  
  - 他ゾーンからのアクセスは不可  
  - 例：VMインスタンス、永続ディスク、マシンタイプ、ゾーンマネージドインスタンスグループ  

## ポイント
- グローバルリソースはどこからでも使えるため、ネットワークやテンプレートなどの共通設定に適している。  
- リージョンリソースはそのリージョン内で利用されるため、例えばストレージやサブネットの範囲管理に使われる。  
- ゾーンリソースはより限定的で、VMなどの実態があるリソースはゾーン単位で管理され、他ゾーンとの直接連携はできない。  

## まとめ
GCPのリソースは、耐障害性やスケーラビリティを確保するため、アクセスできる範囲に応じてグローバル、リージョン、ゾーンの3つのスコープで管理されています。実際の設計や運用では、これらのスコープの違いを理解し、適切にリソースを配置・利用することが重要です。

詳細や具体的なリソース一覧は公式ドキュメントを参照してください。

---


# 85. レイテンシー

## 概要
レイテンシーとは「応答速度」のことを指します。  
GCPのリソースは世界中のリージョンやゾーンに分散配置されており、利用者がアクセスする距離によって応答速度が変わります。

## 詳細
- リージョンは世界中に存在し、リージョン内に複数のゾーンがある。  
- 例えば、東京リージョンのウェブサーバーに東京のユーザーがアクセスすると、応答速度は非常に速く（数十ミリ秒程度）、快適に利用可能。  
- 一方、距離の遠いアメリカのリージョンのサーバーにアクセスすると、応答速度は数百ミリ秒かかる場合がある。  
- これは物理的な距離や通信経路（海底ケーブルなど）による影響が大きい。  

## 実測例
- 東京リージョンのPing応答は約16ミリ秒  
- グローバルロードバランサー経由の応答は約19ミリ秒  
- 大阪リージョンは約23ミリ秒と、距離が遠くなるほどレイテンシーは増加する傾向にある  

## まとめ
レイテンシーは距離に比例して増加し、クラウド利用時の重要な性能指標の一つです。適切なリージョン選択が快適なサービス提供に直結します。

---

# 86. IaaS、PaaS、SaaS

## 概要
クラウドサービスの形態としてよく使われる「IaaS」「PaaS」「SaaS」について解説します。

---

## IaaS（Infrastructure as a Service）
- **意味**：インフラ（物理サーバー、ネットワーク、ストレージなど）をサービスとして提供する。
- **例**：Google Compute Engine（GCE）
- **特徴**：
  - ユーザーはOSやミドルウェア、アプリケーションなどを自由に設定・管理可能。
  - 物理的なハードウェアやネットワークはクラウド事業者（Googleなど）が管理・運用。
  - 大規模なデータセンターやリージョンの構築など、物理レイヤーの管理は不要。
- **責任分界点**：インフラ基盤はクラウド事業者が管理し、それ以外はユーザーの責任範囲。

---

## PaaS（Platform as a Service）
- **意味**：アプリケーションが動作するためのプラットフォーム（ランタイム環境など）をサービスとして提供。
- **例**：Google App Engine、Cloud Run、Cloud Functions
- **特徴**：
  - ユーザーはプラットフォーム上でアプリケーションコードを書いて動かすだけ。
  - OSやランタイム環境、ミドルウェア、ネットワークの管理はクラウド事業者が行う。
  - インフラ構築や環境設定の手間を省き、アプリ開発に注力可能。
- **責任分界点**：プラットフォーム以下はクラウド事業者、アプリケーションとデータはユーザー管理。

---

## SaaS（Software as a Service）
- **意味**：完成したソフトウェアをサービスとして提供。
- **例**：Gmail、会計ソフト、人事管理ソフトなど
- **特徴**：
  - ユーザーはソフトウェアをインストール・管理する必要なく利用できる。
  - 初期費用が抑えられ、すぐに利用開始可能。
  - カスタマイズは制限されるため、仕様に沿った使い方が必要。
- **責任分界点**：ソフトウェア全体はクラウド事業者が管理。ユーザーは利用とデータ管理のみ。

---

## まとめ
| 項目         | IaaS                          | PaaS                             | SaaS                        |
|--------------|-------------------------------|---------------------------------|-----------------------------|
| 管理範囲     | OS以上はユーザーが管理         | アプリケーションとデータのみ管理 | 利用のみ                    |
| 例           | Google Compute Engine          | Google App Engine, Cloud Run    | Gmail, SaaS会計ソフト       |
| 利用者の利点 | 柔軟な環境構築が可能           | 環境構築の手間を省ける           | すぐに利用開始できる         |
| 注意点       | 管理負担が大きい               | カスタマイズは限定的             | カスタマイズ不可             |

システム設計時には、どのレイヤーをクラウド事業者に任せて、どこをユーザー側で管理するかを意識して選択することが重要です。

---

# 87. 可用性とSLA

## 概要
- **SLA（Service Level Agreement）** はクラウドサービスの契約上の約束事を指す。
- SLAは「サービスの稼働率（アップタイム）」などの具体的な目標値（サービスレベルオブジェクティブ：SLO）を数値で示す。

---

## SLAの具体例
- 例：App EngineのSLAは「99.95%の稼働率保証」
  - これは年間約2時間程度のダウンタイムを許容するという意味。
  - SLAを守れなかった場合、Google Cloudのクレジット（料金返還）がある。
- Bigtableの場合
  - ゾーン単位のインスタンスは99.9%
  - マルチクラスター構成なら99.999%
- Cloud DNSはほぼ100%のSLAを提供
  - DNS停止は影響範囲が広いため、非常に高い可用性が求められる。

---

## 可用性とは
- サービスが「止まらずに継続稼働する性質」を指す。
- SLAは可用性の目標値として設定されることが多い。

---

## 補足
- SLAの数字はサービスレベルオブジェクティブ（SLO）と呼ばれ、契約上の目標値。
- 実際の可用性はこれを上回ることもあるが、達成できなければ補償措置が取られる。
- 大手クラウド事業者は各サービスごとに異なるSLAを定めている。

---

## まとめ
- SLAはクラウドサービスの稼働時間や品質の約束。
- 可用性はサービスの継続稼働性を意味し、SLAの重要な指標。
- 各サービスのSLAは公式ドキュメントで確認できる。

---

# 88. NoSQLとRDB

## リレーショナルデータベース（RDB）
- 最も一般的なデータベースの形式。
- **SQL（Structured Query Language）**でデータの検索・挿入・更新・削除を行う。
- **リレーション（関係性）**を持つテーブルで複雑なデータの関連付けが可能。
- **トランザクション**機能により、途中でエラーがあっても一貫性のある状態を保証（途中半端な状態にならない）。
- **スケーリング方法**は主に垂直スケール（サーバー性能向上）が中心。水平スケール（複数インスタンスによる拡張）は苦手。
- 主なRDB製品例：Cloud SQL、Cloud Spanner、Oracle、PostgreSQL、Microsoft SQL Serverなど。

---

## NoSQLデータベース
- 非リレーショナル型のデータベース。
- スキーマ定義が不要または柔軟で、JSONなど多様なデータ形式を扱える。
- 複雑なリレーションを持たないため、**水平スケール**が得意でインスタンス数を増やして拡張可能。
- インスタンス間のデータ同期が必要で、整合性には以下の種類がある：
  - **強い整合性（強整合性）**：最新データを必ず取得（ただし遅延が発生しやすい）
  - **結果整合性（最終的整合性）**：一時的に古いデータを許容し、時間経過で最新状態になる
- 主なNoSQLタイプと製品例：
  - キーバリュー型：Redis（GCPのMemorystore）
  - ドキュメント型：MongoDB、Cloud Datastore、Firestore
  - カラム指向型：Bigtable、Cassandra、HBase
  - グラフ型：Gremlinなど

---

## Google Cloud Spanner
- RDBとNoSQLの良いとこ取りをしたGoogleの分散データベース。
- **水平スケール**が可能でありながらリレーションやトランザクションをサポートするエンタープライズ向けデータベース。
- GCP利用者はぜひ押さえておきたい重要プロダクト。

---

## まとめ
- RDBは複雑なリレーションとトランザクションを得意とし、垂直スケール中心。
- NoSQLは柔軟なスキーマで水平スケールしやすく、整合性は使い方に応じて強・結果整合性を選択。
- Spannerは両者のメリットを兼ね備えた次世代データベース。

---

# 89. 強整合性と結果整合性

## 概要
- **強整合性**と**結果整合性**は、データの同期や反映のタイミングに関する性質であり、データベースだけでなくクラウド設定やDNSの反映などでも使われる用語。

---

## 強整合性（強い整合性）
- データを書き込んだ直後に、その最新データが必ず取得できることを保証。
- 複数のインスタンスやリージョン間でデータ同期を行い、読み込み時に常に最新の情報を提供。
- 同期処理に時間がかかる場合があり、その間は読み取りをロックし、最新データ取得まで待たせることもある。
- 例：銀行口座の残高更新など、リアルタイムかつ正確なデータが必要な場面。

---

## 結果整合性（最終的整合性）
- 書き込み直後に必ずしも最新データが取得できるわけではなく、一時的に古いデータを読み取る可能性がある。
- データの反映に時間差があり、遅延を許容しつつ最終的に整合性が取れる状態になる。
- レイテンシーが低く、素早くデータを提供することができる。
- 例：SNSのツイートフィードなど、多少の遅延は許容されるが高速なレスポンスが重要な場面。

---

## 具体例と応用
- クラウドストレージ（Google Drive、Dropboxなど）では、ファイル更新の反映に時間差があることが多い。
- 複数リージョンやインスタンスで同じデータを扱う際、最新のデータ取得を保証するには同期処理が必要。
- アプリケーションの要件によって、強整合性を重視するか結果整合性を許容するかを選択する。

---

## まとめ
| 性質       | 特徴                                  | 主な用途例                  |
|------------|-------------------------------------|----------------------------|
| 強整合性   | 常に最新データを保証、同期遅延あり  | 金融取引、在庫管理         |
| 結果整合性 | 古いデータの可能性あり、レスポンス速い | SNSフィード、ログ閲覧       |

- 強整合性はデータの一貫性を最優先し、結果整合性は速度や可用性を重視する場面で使い分ける。

---


# 89. 強整合性と結果整合性

## 概要
- **強整合性**と**結果整合性**は、データの同期や反映のタイミングに関する性質であり、データベースだけでなくクラウド設定やDNSの反映などでも使われる用語。

---

## 強整合性（強い整合性）
- データを書き込んだ直後に、その最新データが必ず取得できることを保証。
- 複数のインスタンスやリージョン間でデータ同期を行い、読み込み時に常に最新の情報を提供。
- 同期処理に時間がかかる場合があり、その間は読み取りをロックし、最新データ取得まで待たせることもある。
- 例：銀行口座の残高更新など、リアルタイムかつ正確なデータが必要な場面。

---

## 結果整合性（最終的整合性）
- 書き込み直後に必ずしも最新データが取得できるわけではなく、一時的に古いデータを読み取る可能性がある。
- データの反映に時間差があり、遅延を許容しつつ最終的に整合性が取れる状態になる。
- レイテンシーが低く、素早くデータを提供することができる。
- 例：SNSのツイートフィードなど、多少の遅延は許容されるが高速なレスポンスが重要な場面。

---

## 具体例と応用
- クラウドストレージ（Google Drive、Dropboxなど）では、ファイル更新の反映に時間差があることが多い。
- 複数リージョンやインスタンスで同じデータを扱う際、最新のデータ取得を保証するには同期処理が必要。
- アプリケーションの要件によって、強整合性を重視するか結果整合性を許容するかを選択する。

---

## まとめ
| 性質       | 特徴                                  | 主な用途例                  |
|------------|-------------------------------------|----------------------------|
| 強整合性   | 常に最新データを保証、同期遅延あり  | 金融取引、在庫管理         |
| 結果整合性 | 古いデータの可能性あり、レスポンス速い | SNSフィード、ログ閲覧       |

- 強整合性はデータの一貫性を最優先し、結果整合性は速度や可用性を重視する場面で使い分ける。

---

# 91. ステートレスとステートフル

## 概要
- **ステートレス**：状態（ステート）を維持しない設計や仕組み。
- **ステートフル**：状態を維持・保持する設計や仕組み。
- 文脈や使われるコンテキストによって意味合いが変わる。

---

## ネットワーク（ファイアウォール）における例
- TCPの通信では、送信だけでなく応答（戻りの通信）もある。
- **ステートフルファイアウォール**：戻り通信を自動的に許可し、状態を管理する。
- **ステートレスファイアウォール**：戻り通信も手動で許可設定が必要で、状態を保持しない。

---

## アプリケーション設計における例
- ECサイトの買い物カゴの状態管理が例としてよく使われる。

### ステートフル設計
- アプリケーションインスタンス自体が買い物カゴの状態を内部で保持する。
- ロードバランサーは同じユーザーのリクエストを同じインスタンスに送る必要がある（セッション維持）。
- インスタンス障害時に状態が失われるリスクがある。

### ステートレス設計
- 状態はアプリケーション外のキャッシュやデータベース（例：Memcached、NoSQL）に保持。
- 複数インスタンス間で状態共有し、どのインスタンスにリクエストが流れても対応可能。
- ロードバランサーはリクエストを均等に振り分けられる（セッション維持不要）。

---

## まとめ
- **ステートレス**は状態を持たず、スケーラビリティや冗長性を高めやすい。
- **ステートフル**は状態を保持し、連続した処理が必要なケースに向く。
- 適用範囲（ネットワーク機器かアプリケーションか）によって意味が異なるが、基本的に「状態を持つか持たないか」の違い。

---


# 92. カナリアデプロイ、ブルーグリーンデプロイ、ローリングデプロイ

## 概要
- いずれのデプロイ方法も **ダウンタイムなし** でアプリケーションの更新が可能なモダンな手法。
- 従来のメンテナンスではシステム停止やダウンタイムが発生していたが、これらの手法は高可用性を保つ。

---

## 1. カナリアデプロイ
- トラフィックの一部（例：3割）だけ新バージョン（バージョン2）に流し、動作確認を行う。
- 例えは「カナリア」（炭鉱で有毒ガス検知に使われた小鳥）に例えられる。
- 問題がなければ徐々にトラフィックを増やし、全体移行へ。

---

## 2. ブルーグリーンデプロイ
- 現行バージョン（ブルー）とは別に新バージョン（グリーン）を用意し、並行稼働させる。
- 新バージョンの動作確認後、一気に全トラフィックをグリーンに切り替える。
- ユーザー視点では突然の切り替えに見えるがダウンタイムなし。

---

## 3. ローリングデプロイ（ローリングアップデート）
- 複数のインスタンスが稼働中に、順次インスタンスを新バージョンに更新していく。
- 常に稼働インスタンスが存在するため、ダウンタイムが発生しない。
- GAEやGoogle Kubernetes Engineなどのクラウドサービスでサポートされている。

---

## まとめ
- いずれの方法もサービス停止なしで安全にバージョンアップが可能。
- トラフィックの制御や段階的切り替えでリスクを抑えながら運用できる。
- GCPなどのクラウドプラットフォームでこれらのデプロイ方法を活用可能。

---


# 93. マイクロサービス

## 概要
- マイクロサービスはアプリケーションを小さい機能単位（サービス）に分割し、それぞれが連携してシステムを構成する設計手法。
- 対義語は「モノリシック（Monolith）」で、一つのサーバー・アプリケーションに複数の機能をまとめて構築する方式。

---

## マイクロサービスの特徴とメリット
- **クラウドと相性が良い**  
  クラウド環境（例：クラウドファンクション、Cloud Run、Kubernetes Engine）にデプロイしやすい。  
- **スケーリングが容易**  
  負荷に応じて個別サービスを自動的にスケールアップ・ダウン可能。  
- **再デプロイの柔軟性**  
  一部のサービスに障害があっても、全体の停止を避けられる。  
- **ダウンタイムなしの更新**  
  複数バージョンを併存させてトラフィック分散しながらバージョンアップ可能。  
- **開発スピードの加速**  
  小さい単位で独立して開発・デプロイできるため、開発の柔軟性が増す。  
- **多言語混在や技術選択の自由**  
  サービスごとに異なるプログラミング言語や技術を使える。  
- **再利用性の向上**  
  サービス単位で他システムへの流用がしやすい。  
- **コンテナ利用**  
  コンテナ化してレジストリで管理し、別システムでも動かせる。

---

## モノリシックとの比較
- モノリスは単一サーバー・アプリで機能を一括管理するため、障害時は全体に影響。  
- バージョンアップ時にサーバー停止やダウンタイムが発生しやすい。  
- 技術的制約（言語統一など）が出やすい。

---

## デメリット・課題
- 多数のサービスのバージョンやコード、インターフェース管理が複雑化する。  
- サービス間通信が増え、システム全体の連携が難しくなる。  
- 分散トランザクションなど、一貫性の維持が技術的に難しい場合がある。  
- 管理コストが増加し、設計・運用の難易度が高まる。

---

## まとめ
- マイクロサービスはクラウド時代に適した柔軟な設計手法。  
- 多くのメリットがある一方で複雑性も伴うため、適材適所での導入が重要。  
- 銀の弾丸ではなく、利用シーンや規模に応じた判断が求められる。

---

# 94. コンテナ

## コンテナとは
- 仮想化技術の一種だが、従来の仮想マシン（VM）とは異なる。
- VMはゲストOSを含むため重いが、コンテナはホストOSを共有しゲストOSを持たず軽量。
- 軽量であるため、物理リソースを効率的に利用でき、多くのアプリケーションを同時に動かせる。

## VMとコンテナの違い
| 項目           | 仮想マシン（VM）               | コンテナ                      |
|----------------|------------------------------|-----------------------------|
| ゲストOS       | 含む（Windows/Linuxなど）       | 含まない（ホストOS共有）       |
| 重量           | 重い（数ギガバイト）            | 軽い（数メガバイト程度）        |
| 起動速度       | 遅い                         | 速い                         |
| リソース効率   | 低い                         | 高い                         |
| 移動・配置の容易さ | 難しい                       | 容易                         |

## コンテナのメリット
- 軽量で高速に起動・移動可能。
- スケーリングや冗長化がしやすく、サービスの可用性向上に貢献。
- マイクロサービス化に適している。
- クラウドとの相性が良く、GCPのCloud RunやKubernetes Engineなどに簡単にデプロイ可能。

## 代表的なコンテナ技術
- **Docker**  
  最も有名で広く使われているコンテナエンジン。  
- **Docker Hub**  
  公式のコンテナイメージの公開・共有サービス。  
  - 例：MySQL、MariaDB、WordPressなどのコンテナが公開されている。

## GCPにおけるコンテナ関連サービス
- **Cloud Build**  
  Dockerfileからコンテナイメージをビルドするサービス。  
- **Container Registry / Artifact Registry**  
  コンテナイメージの保管・管理サービス。Artifact Registryはコンテナ以外も管理可能。  
- **Cloud Run**  
  コンテナをサーバーレスで実行するサービス。  
- **App Engine Flexible Environment**  
  コンテナを使ったアプリケーション実行環境。  
- **Google Kubernetes Engine (GKE)**  
  Kubernetesを使って大量のコンテナを管理・オーケストレーションするサービス。

## まとめ
- コンテナは仮想マシンより軽量でリソース効率が良く、迅速な起動・移動が可能。
- マイクロサービスと親和性が高く、クラウド環境での利用に適している。
- Dockerが事実上の標準技術であり、多くのクラウドサービスでサポートされている。
- GCPにはコンテナのビルド、保管、実行、管理を支援する多彩なサービスがある。


# 小テスト22: クラウド関連の用語集

- **クラウドコンピューティング**  
  インターネット経由で必要な時に必要なだけITリソースを利用できる仕組み。

- **IaaS (Infrastructure as a Service)**  
  サーバーやネットワークなどのインフラをサービスとして提供。

- **PaaS (Platform as a Service)**  
  アプリケーション開発のためのプラットフォームをサービスとして提供。

- **SaaS (Software as a Service)**  
  ソフトウェアをインターネット経由で利用できるサービス形態。

- **仮想マシン (VM: Virtual Machine)**  
  物理マシン上に作られた仮想的なコンピューター。

- **コンテナ**  
  軽量な仮想化技術で、アプリケーションと必要な環境をパッケージ化し実行。

- **マイクロサービス**  
  アプリケーションを小さな独立したサービスに分割して開発・運用する手法。

- **ブルーグリーンデプロイメント**  
  新旧の環境を用意し、切り替えでダウンタイムを防ぐデプロイ方法。

- **カナリアデプロイメント**  
  一部のユーザーに新バージョンを試験的に展開し、問題なければ全体に展開する手法。

- **ローリングデプロイメント**  
  順次インスタンスを更新しながらサービスを継続するデプロイ方法。

- **ロードバランサー**  
  複数のサーバーにトラフィックを分散し、可用性や性能を向上させる機器やサービス。

- **スケーリング**  
  システムの処理能力を増減させること。垂直スケーリング（性能強化）と水平スケーリング（台数増減）がある。

- **高可用性 (HA: High Availability)**  
  システムが長時間安定して稼働し続ける能力。

- **クラウドストレージ**  
  インターネット経由で利用できるデータ保存サービス。

- **Kubernetes**  
  コンテナのオーケストレーションツールで、複数のコンテナを効率的に管理。

- **CI/CD (継続的インテグレーション/継続的デリバリー)**  
  開発プロセスの自動化による迅速なソフトウェアリリースの仕組み。

- **Infrastructure as Code (IaC)**  
  インフラ構築や管理をコードで自動化する手法。

- **サーバーレス**  
  サーバー管理不要でコードを実行できるクラウドサービス形態。

- **APIゲートウェイ**  
  複数のAPIの管理やアクセス制御を行うサービス。

- **監視・ロギング**  
  システムの状態を監視し、ログを収集・分析することで問題を早期発見する仕組み。

---

※用語の意味や概要を中心にまとめています。
