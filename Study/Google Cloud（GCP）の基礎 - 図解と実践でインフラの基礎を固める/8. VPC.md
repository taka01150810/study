# 50. VPCネットワークの概要

## 概要
- VPC（Virtual Private Cloud）は仮想ネットワークのことで、Compute EngineのVMやApp Engine、Kubernetes Engineなどのインスタンス同士の接続を提供する。
- GCPプロジェクトにはあらかじめ「デフォルトネットワーク」が作成されている。
- デフォルトネットワーク内にはリージョンごとにサブネットが存在し、サブネットごとにIPアドレス範囲（CIDR形式）が割り当てられている。

## サブネットとIPアドレス
- サブネットのIPアドレス範囲はCIDR表記（例：/20）で表され、約4000個の内部IPアドレス空間を持つ。
- サブネットは各リージョンに紐づいている。
- サブネット内および同じVPCネットワーク内のサブネット間は通信可能。

## ネットワーク間の通信
- 異なるVPCネットワーク間はデフォルトでは通信できない。
- IPアドレスが似ていても、ネットワークが異なれば通信不可。
- ネットワーク間通信を可能にするには「VPCピアリング」を使う。

## VPCピアリング
- VPC同士を直接接続する仕組み。
- IPアドレス範囲が重複している場合はピアリング不可。
- ルーターやゲートウェイを用意する必要なく接続可能。
- 異なるプロジェクト間でも設定できる。

## 共有VPC
- 組織単位でVPCを共有し、複数プロジェクトのリソース間で通信可能にする仕組み。

## まとめ
- VPCは仮想ネットワークでインスタンスの接続を管理する。
- デフォルトネットワークが事前に用意されている。
- サブネットを跨いだ通信は可能だが、異なるVPCネットワーク間は通信不可（ピアリング等で接続可能）。
- CIDRでIPアドレス範囲を管理し、ネットワークの構築や通信制御を行う。

---

# 51. VPCネットワークの作成と動作確認

## 概要
- 前回のVPCネットワーク概要の続きで、実際にVPCネットワークの作成や動作確認を行う。
- 3つのVMが異なるリージョン・ネットワークに存在し、内部IPアドレスは似ているが通信できるかを検証。

## VMのネットワーク状況
- VM1は「デフォルト」ではないカスタムVPCネットワークに属し、特定のサブネットを使用。
- 他のVMはデフォルトネットワークおよびデフォルトサブネットに属している。
- 異なるVPCネットワークに属するVM同士は通信できない。

## 動作確認（Pingテスト）
- 自身へのPingは成功。
- 別ネットワーク（異なるVPC）へのPingは失敗。
- 同じネットワーク内（異なるサブネット）へのPingは成功。

## VPCネットワーク管理画面の確認
- VPCネットワークの画面ではデフォルトネットワークが表示され、多数のサブネットが事前に作成されている。
- サブネットはリージョンに紐づき、それぞれ固有のIPアドレス範囲を持つ（例：4094個のIPアドレス）。
- 自分でVPCネットワークやサブネットを作成・追加できる。

## サブネット作成
- サブネット作成時に名前、リージョン、IPアドレス範囲（CIDR表記）を指定。
- セカンダリーIP範囲も追加可能。
- 複数のサブネットをネットワーク内に作成し、IPアドレス空間を分割できる。

## VM作成時のネットワーク設定
- VM作成時にネットワークとサブネットを指定可能。
- ネットワークに紐づくサブネットがないリージョンでVMを作成しようとするとエラーになる。
- 例えば、カスタムVPCのサブネットが大阪リージョンにしかない場合、ラスベガスリージョンにはVMを作れない。
- デフォルトネットワークは多くのリージョンにサブネットがあるため、どのリージョンでもVM作成が可能。

## まとめ
- VPCネットワークはデフォルトで作成され、多数のサブネットがリージョンごとに割り当てられている。
- 自分でVPCやサブネットを作成し、リージョンやIP範囲を指定できる。
- VMは属するVPCネットワークのサブネットのIPアドレス範囲から内部IPが割り当てられる。
- 異なるVPC間の通信はできず、同じVPC内のサブネット間は通信可能。
- ネットワークとリージョンの関係、IPアドレスの割り当てのイメージを持つことが重要。

---

# 小テスト8: VPC（仮想ネットワーク）

## 問題例（サンプル）
1. VPCとは何の略称ですか？  
2. VPCネットワークの主な役割を簡単に説明してください。  
3. デフォルトのVPCネットワークにはどのような特徴がありますか？  
4. サブネットはどの単位で区切られていますか？  
5. 同じVPC内の異なるサブネット間で通信は可能ですか？  
6. 異なるVPCネットワーク間で直接通信はできますか？なぜですか？  
7. VPCピアリングとは何ですか？その条件は？  
8. VPCネットワークはどのようなスコープ（グローバル/リージョン）を持ちますか？  
9. VMインスタンスのIPアドレスはどこから割り当てられますか？  
10. カスタムVPCとデフォルトVPCの違いは何ですか？

## まとめ
- VPC（Virtual Private Cloud）は仮想ネットワークのこと。  
- Google Cloud上でインスタンス（VMやKubernetesなど）を接続するためのネットワークを構築・管理できる。  
- デフォルトVPCは初期状態で自動作成され、多数のサブネットがリージョン単位で事前に用意されている。  
- サブネットはリージョン単位で区切られ、それぞれ固有のIPアドレス範囲を持つ。  
- 同じVPC内なら異なるサブネット間でも通信可能だが、異なるVPC間は原則通信不可。  
- VPCピアリングを使うことで、IPアドレス範囲が重複しない条件のもと異なるVPC間を接続できる。  
- VPCネットワークはグローバルリソースであり、サブネットはリージョンに紐づく。  
- VMの内部IPは所属するサブネットのIPアドレス範囲から割り当てられる。  
- ユーザーはカスタムVPCを作成して、ネットワーク設計を自由にカスタマイズできる。

---
