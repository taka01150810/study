# 66. Cloud Functionsの概要

---

## Cloud Functionsとは
- Google Cloudのサーバーレス環境
- 小さな関数単位でクラウド上に配置・実行できる
- サーバーの管理やプロビジョニング不要
- リクエストに応じて自動スケーリング
- 実行状況のモニタリングやログ管理、デバッグが可能
- アクセス制御によるセキュリティ設定も可能
- ハイブリッドクラウドや他クラウド、オンプレ環境からも呼び出せる

## 対応言語
- Python
- PHP
- Go
- .NET など多様な言語に対応

## 料金体系
- 重量課金制で非常に安価
- 無料枠：最初の200万回呼び出しまで無料
- 200万回超過後：100万回あたり約40ドル
- CPUやメモリ使用量に応じた課金もあり
- 小規模な処理や頻度の少ないバッチ処理に最適

## 主なユースケース
- GitHubなどのソースコード管理でのイベントトリガー
- Slack連携などの通知処理の仲介役
- 重い処理のオフロード（バックグラウンド処理）
- IoTデバイスのセンサーイベント処理
- Pub/Subイベントのハンドリング
- 画像のサムネイル生成やAI画像処理との連携
- 会話データの収集・AI連携・データベース保存など

## 特徴・利点
- 小さな単位のマイクロサービスとして利用可能
- 複数の関数を連携させて複雑なシステム構築も可能
- 運用負担が少なく、拡張性に優れている


# 67. Cloud Functionsの作成

## Cloud Functionsの作成手順

- GCPの「Cloud Functions」メニューから新規関数を作成
- 第1世代と第2世代があるが、現在は第1世代で作成（第2世代はプレビュー）
- 第2世代は性能・スケーラビリティ・連携機能が強化予定

## 関数設定のポイント

- 関数名、リージョン（例：東京）を指定
- トリガーはHTTPリクエストが基本（他にもストレージやFirestore、Pub/Subなど多様なイベントに対応）
- 誰でも呼び出せるか認証必須か選択可能
- ランタイム（Python, Node.js, Java, PHPなど）やスペック、タイムアウトなどを設定可能
- ネットワークやVPC接続、暗号化設定も可能
- 環境変数の設定もできる

## コードのデプロイ方法

- インラインエディタに直接記述
- ZIPファイルアップロード
- Cloud StorageやCloud Source Repositoryから取得も可能

## サンプル関数（Python）

- HTTPリクエストを受け、JSONの`message`を返す簡単なHelloWorld関数
- `message`がなければ単純に"Hello World"を返す
- よりシンプルにコードをコメントアウトしても動作可能

## デプロイと実行

- デプロイは約12分程度で完了
- 関数が作成されるが、呼び出し時に料金が発生（無料枠あり）
- デプロイ後はHTTPエンドポイントが払い出される
- GCPコンソール内で関数のテストが可能
- ブラウザや外部クライアントからもHTTPリクエストで呼び出せる

## 実行結果例

- 単純に"Hello World"を返す
- JSONで`message`を送ると、その内容を返す

## その他

- ログをコンソールで確認可能
- 実際に関数を開発しながらログを活用して調整するとよい


# 小テスト15: Cloud Functions

---

## 問題例・ポイントまとめ

- **Cloud Functionsとは？**  
  サーバーレスで動く関数実行サービス。サーバー管理不要でスケーラブル。

- **主な特徴**  
  - サーバーのプロビジョニングや管理不要  
  - トラフィックに応じた自動スケーリング  
  - 実行ログのモニタリングやデバッグ可能  
  - アクセス制御・セキュリティ設定あり  
  - 他のGCPサービスや外部システムとの連携が容易

- **ランタイム対応言語**  
  Python、Node.js、Go、Java、PHP、Ruby、.NETなど多数

- **トリガーの種類**  
  - HTTPリクエスト  
  - Cloud Storageのイベント  
  - FirestoreやFirebaseのイベント  
  - Pub/Subメッセージ  
  - その他GCPサービスのイベント（Cloud Schedulerなど）

- **料金体系**  
  - 実行時間、呼び出し回数、メモリ・CPU使用量に基づく従量課金  
  - 初期200万回呼び出しは無料枠あり  
  - 非常に低価格で利用可能

- **ユースケース例**  
  - 軽量処理のオフロード  
  - イベントドリブンな処理（ファイルアップロード、メッセージ処理）  
  - リアルタイム分析・データ処理  
  - 他システムやAPIとの連携  
  - IoTデータ処理

---

※本テストはCloud Functionsの概要、作成方法、特徴を理解しているかを問う内容が中心です。

