# 80. Bigtableの概要

## Bigtableとは
- Googleが提供するエンタープライズレベルの**ノースケール（NoSQL）カラム指向データベース**。
- 大規模でスケーラブルなアプリケーションを支えるために設計されている。
- 低レイテンシ（10ミリ秒未満）、高スループット（毎秒数百万件の読み書き、200MB/秒規模）が特徴。

## 利用用途・ユースケース
- 広告配信（アドテク）、金融（フィンテック）、デジタルメディア、IoTなどの大量データをリアルタイムで扱う場面。
- ECサイトや小売りの大規模在庫管理におけるデータ変化の高速キャプチャと保存。
- Google内部ではGmailのバックエンドとしての利用実績あり（現在はSpannerへ移行の話もある）。
- IoTソリューションや広告の顧客行動データの統合・分析基盤として利用される。

## Bigtableと他のGoogleデータベースの比較
- **BigQuery**  
  - 大量の構造化データを分析・レポートするためのデータウェアハウス。  
  - 分析・アナリティクスに特化。  
- **Firestore / Datastore**  
  - スループットやレイテンシ要件がBigtableほど厳しくない場合の選択肢。  
  - コスト面で有利。  

## 特徴・機能
- カラム指向（列単位）のデータベースで、大量の類似カラムデータの高速抽出に適している。
- ダウンタイムなしでクラスターサイズの変更が可能。
- フレキシブルな自動レプリケーションにより耐障害性を確保。
- 強い整合性（書き込み直後の読み取りが保証される）も選択可能。
- 顧客管理の暗号化キー対応。
- HBaseやCassandraなどのカラム指向データベースとの互換性あり。
- DBTツールなどでテーブル構造の管理が可能。

## 技術的ポイント
- 低レイテンシで大量のデータを扱いながら、高いスループットを維持。
- HadoopやHBaseなどの分散処理システムと連携可能なエコシステム。
- 年間稼働率SLAは約99.9%（約1時間のダウンタイム相当）など、柔軟に選べるSLAプラン。

## まとめ
- Bigtableは超大規模データのリアルタイム読み書きに最適化された、Googleの実績あるカラム指向NoSQLデータベース。
- IoT、広告、金融、小売りなど大量データ処理が必要なエンタープライズ領域で活用されている。
- 分析はBigQuery、トランザクションや汎用用途はFirestoreやDatastoreと使い分けるケースが多い。

---

# 81. cbtによるBigtable操作

## Bigtableの作成
- BigtableインスタンスはGoogle Cloud Consoleから簡単に作成可能。
- インスタンス作成時にストレージ種類（SSD or HDD）、ノード数（例：2ノード）、リージョンやゾーンを選択。
- SSDは高パフォーマンスだがコストはHDDの約6倍。
- ノード数が増えると料金が高くなるため、用途に応じてFirestoreやDatastoreの選択も検討。

## cbtツールについて
- `cbt`はCloud Bigtable専用のコマンドラインクライアントツール。
- GoogleがGo言語で開発したクライアントライブラリを利用している。
- クラウドシェルには標準でインストール済みのため、すぐ利用可能。
- インストールはCloud SDKのコンポーネントアップデートで可能。

## cbtによる操作手順の概要
1. **設定ファイル作成**  
   - プロジェクトIDやインスタンス名を設定ファイルに記述し準備。
2. **テーブル作成**  
   - `cbt createtable` コマンドでテーブル作成（例：マイテーブル）。
3. **列ファミリー作成**  
   - `cbt createfamily` でテーブル内に列ファミリー（例：cf1）を作成。
4. **データ書き込み**  
   - `cbt set` コマンドで、特定の行キーと列ファミリーに対して値をセット。
5. **データ読み取り**  
   - `cbt read` で書き込んだデータを確認可能。
6. **テーブル・インスタンスの管理**  
   - テーブル削除、インスタンス情報の確認、クラスター追加やスケールも可能。
   - バックアップ作成も対応。

## 料金イメージ
- 2ノードのSSD構成で月額約5万円程度。
- ノード数に応じてコストは増加。
- 高スループットが必要な場合はノード増設が必須。

## その他
- BigtableのモニタリングはCPU使用率やストレージ利用率などを確認できる。
- `cbt`は中身のデータ確認に便利なツール。
- クライアントライブラリは5言語以上で提供されており、プログラムからも操作可能。
- 本講義は`cbt`を使った簡易操作のデモンストレーション。

---

# 小テスト20: Bigtableの概要

## Bigtableの特徴
- エンタープライズ向けの大規模でスケーラブルなNoSQLデータベース
- カラム指向（カラム型）データベースで高速な読み書きが可能
- 低レイテンシー（10ミリ秒未満）と高スループット（秒間数百万件の読み書き）を実現
- ダウンタイムなしでスケール可能、構成変更もシームレスに対応
- 主なユースケース：広告配信、フィンテック、IoT、デジタルメディア、大規模ECサイトの在庫管理など
- Googleのサービス（例：Gmailのバックエンド）でも実績あり

## BigtableとBigQueryの違い
- Bigtable：大量の読み書き処理に最適化されたカラム指向NoSQLデータベース
- BigQuery：大量の構造化リレーショナルデータを分析・レポーティングするためのエンタープライズ向けデータウェアハウス

## その他のポイント
- ストレージ種別はSSDとHDDがあり、SSDは高速だがコスト高
- 高い可用性と整合性を備え、複数のレプリケーション構成が可能
- 他のオープンソース分散データベース（HBase、Cassandra）と互換性あり
- 低コストで済む場合はFirestoreやDatastoreを選択することも検討可能
- 大規模データのリアルタイム処理や分析基盤として利用されることが多い

---
