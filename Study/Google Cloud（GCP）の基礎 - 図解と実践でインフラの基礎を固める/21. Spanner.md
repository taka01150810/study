# 82. Spannerの概要

## Spannerの特徴
- エンタープライズ向けフルマネージドのリレーショナルデータベース
- **無制限の水平スケーリング**が可能
- **強整合性**を維持しつつ大規模分散を実現
- **99.999%の高可用性（SLA）**を提供、年間数分程度の停止時間のみ
- 標準的なSQL（SELECT、INSERTなど）を利用可能
- 計画的なダウンタイムなしでスケール可能
- リージョンや大陸を跨いだデータ同期も強整合性を保持

## 強整合性と分散
- 従来の分散リレーショナルDBはスケーリング時に整合性を保つのが難しい
- Spannerは複数インスタンス間でも**強整合性を維持しつつ同期**を実現
- 書き込み後すぐに最新データを全インスタンスで読み出し可能
- そのため、データの不整合や古いデータの読み込みを防止

## データ構造と内部仕組み
- データは「スプリット」と呼ばれるチャンクに分割され、複数ゾーンに分散配置
- 各スプリットはリーダーとフォロワーで構成され、効率的にデータアクセスをコントロール
- 世界中のデータセンター間で**TRUETIME技術**を使い正確な時間同期を実現
  - GPSや原子時計を利用し、強整合性の根拠となる正確な時刻を共有

## 利用例・コスト感
- 例：ドラゴンクエストウォークのゲーム基盤として採用
- 高性能・高可用性・スケーラビリティを備えた基盤構築が可能
- 以前は高コストだったが、最近は比較的低コストで利用開始可能に

## まとめ
- Spannerは従来のリレーショナルDBの弱点である水平スケール問題を克服
- フルマネージドで複雑なデータベース管理を不要にし、利用者はイノベーションに注力できる
- ACIDトランザクションに対応し、信頼性・整合性の高いデータ処理が可能

---

# 83. Spannerの作成

## インスタンス作成
- GCPコンソールの「Spanner」メニューからインスタンス作成へ
- APIが有効でない場合は有効化する必要あり
- インスタンス名やIDを設定（例：`demo_instance`）
- リージョン構成を選択（リージョン単位 or マルチリージョン）
  - マルチリージョン例：東京、大阪、ベルギー、オランダ、ロンドンなど
- 今回は東京リージョンを選択、3つの異なるゾーンに読み書きレプリカ配置
- 処理ユニット（コンピューティング単位）はノード単位か単位数指定可能
  - 100単位から開始可能で、スモールスタートに適している
  - 以前より低コスト（月約1万円～）で利用可能

## データベース作成
- インスタンス作成後にデータベースを作成
- 従来のリレーショナルDBと同様に、データベース→テーブルの構造
- データインポート・エクスポートやバックアップ、クエリ実行が可能

## テーブル作成
- 例として「MYTABLE」を作成
- プライマリキー：`ID`（INT64型）、カラム：`NAME`（STRING型）
- プライマリキーによりデータがチャンク（スプリット）分割される

## データ操作
- Webコンソール上でINSERT、UPDATE、DELETE操作が可能
- SQLクエリでのデータ読み取りや挿入も可能
- 実例：`INSERT INTO MYTABLE (ID, NAME) VALUES (1, '高橋')`など

## モニタリング
- CPU使用率、クエリのレイテンシーや統計情報を確認できる
- 負荷状況やパフォーマンスを視覚的に把握可能

## まとめ
- Spannerの使い方は従来のリレーショナルDBとほぼ同様
- 無制限のスケーリング、強整合性、高可用性が特徴
- グローバル規模の大規模データに対して特に価値を発揮

---

# 小テスト21: Spannerの概要

1. **Spannerとは？**  
   - Googleのエンタープライズ向けフルマネージドリレーショナルデータベース  
   - 無制限のスケーリングが可能  
   - 強い整合性（強整合性）を持つ  
   - 99.999%の高い可用性を実現  

2. **特徴**  
   - リレーショナルデータベースの柔軟なクエリ（SQL）を利用可能  
   - 大規模分散環境でも一貫性のあるデータ管理が可能  
   - 複数リージョンにまたがる同期（例：米国、日本など）  
   - データの書き込み・読み込みで常に最新のデータを返す  
   - スケーリングしてもパフォーマンス低下がほぼない  

3. **内部構造**  
   - データを「スプリット」と呼ばれるチャンクに分割しゾーンに分散配置  
   - ゾーンごとにリーダーが存在し、最新データを管理・提供  
   - TRUETIME技術を使い、各データセンター間で正確な時間同期を実施  
   - 高いパフォーマンスと耐障害性を両立  

4. **利用例**  
   - 大規模ゲーム（例：ドラゴンクエストウォーク）基盤などに採用  
   - 高スケーラビリティ、高可用性が求められるシステム向け  

5. **まとめ**  
   - Spannerは従来のリレーショナルDBの弱点であるスケーリング問題を克服  
   - グローバル分散、強整合性を持ちながら高パフォーマンスを実現する先進的なDB  

---
