# 68. Cloud Runの概要

---

## 概要  
Cloud Runは、フルマネージドのサーバーレスコンテナ実行プラットフォームです。  
- サーバー管理不要でコンテナを簡単にデプロイ・実行可能  
- 多くのプログラミング言語に対応（Go, Python, Java, .NET, Node.jsなど）  
- コンテナ単位でのデプロイなので、言語やフレームワークに制約なし  
- 自動スケーリング対応で需要に応じてインスタンス数が増減  
- 複数ゾーンに自動複製され、高い可用性を持つ  

## 料金体系  
- 使用したリソース（CPU、メモリ、ネットワーク）に対する従量課金制  
- 利用しなければ料金は発生しない（サーバーレスの特徴）  
- 無料枠あり（例：200万リクエストまで無料）  
- 100ミリ秒単位で課金計算  

## Cloud Runの特徴  
- コンテナ化されたアプリケーションを簡単にクラウド上で動かせる  
- Cloud Functionsのように小さな関数単位ではなく、コンテナ単位でのデプロイ  
- マイクロサービスの一部として利用可能  
- GCP内の各種サービス（Cloud Storage、Cloud SQL、BigQueryなど）と連携可能  

## デプロイ方法の例  
- コンテナイメージをGoogle Container Registry（GCR）やArtifact Registryに登録し、そこからデプロイ  
- Cloud BuildやCloud Source Repositoriesと連携してビルド・デプロイ可能  
- Docker Hubなど外部コンテナレジストリのイメージも利用可能（ただし一旦GCPのレジストリに入れる必要あり）  

## ユースケース例  
- WebサイトやAPIのホスティング  
- モバイルバックエンドサービス  
- 軽量なデータ変換処理  
- BigQueryやCloud SQLなどのGCPサービスとの連携処理  

---

Cloud Runはサーバーレスの利便性とコンテナの柔軟性を兼ね備えた、スケーラブルかつ安価に使えるコンテナ実行サービスです。

# 69. Cloud Runの作成

---

## 概要  
Cloud Runで簡単な「Hello World」コンテナを実際にデプロイして動かす手順を解説。  

## デプロイの流れ  
- GCPコンソールの「Cloud Run」から「サービスの作成」を選択  
- 既存のサンプルコンテナイメージを指定してデプロイ可能  
- サービス名、リージョンを設定（リージョンによって応答速度や料金が異なる）  
- 料金モードは主に2種類  
  - リクエストベース課金（デフォルト）：リクエスト実行時のみ課金  
  - 常時配置課金モード：常にコンテナを起動し続ける課金（単価は高め）  
- インスタンス数の最小・最大設定が可能（自動スケーリング対応）  
- トラフィックのアクセス制御（外部/内部のみ、認証あり/なし）も設定可能  
- コンテナのポート番号やCPU/メモリスペックも選択可能  
- 実行環境は第1世代（デフォルト）と第2世代プレビューがある  
  - 第1世代はコールドスタート時に高速に起動  
  - 第2世代はパフォーマンス向上だがコールドスタート時間は長め  

## デプロイ完了後  
- 数十秒でデプロイ完了し、公開URLが発行される  
- シンプルなHello World Webページが表示される  
- Cloud Runの管理画面でメトリクス（リクエスト数、CPU使用率、メモリ使用量など）を確認可能  
- ログも確認でき、アプリケーションの正常稼働を監視可能  

## トラフィック管理・リビジョン  
- 新しいバージョン（リビジョン）を追加可能  
- 複数リビジョン間でトラフィック分散が簡単に設定できる（例：7割旧版、3割新版本番テスト）  
- アプリのダウンタイムなしでバージョンアップが可能  

## イベント連携  
- GCPの各種イベント（Cloud Storage、BigQuery、Cloud Functionsなど）と連携し、トリガーとしてCloud Runを起動可能  

## まとめ  
- Cloud Runはコンテナ技術を活用した新しいサーバーレスサービスで、  
- 簡単・高速にコンテナをデプロイできる  
- 自動スケーリングやトラフィック分散など高度な運用機能も備える  
- GCPが注力している今後の発展が期待されるサービス  

---

今後のレクチャーで、さらに応用的なデプロイ方法や設定についても解説予定。

# 70. コードからのCloud Runデプロイ

---

## 概要  
前回は既存のコンテナをデプロイしましたが、今回はプログラムコードからコンテナをビルドし、Cloud Runへデプロイする手順を解説します。  

## 手順の流れ  
1. **GitHubからサンプルコードをクローン**  
   - Cloud ShellでGitコマンドを使い、公式リポジトリからHelloWorldのGo言語コードをダウンロード  
2. **コード内容**  
   - シンプルなGo言語のWebアプリで、HTTPポート8888で「Hello World」を返す  
   - Dockerfileでコンテナイメージのビルド指示が書かれている  
3. **コンテナビルドとプッシュ**  
   - `gcloud builds submit` コマンドを使ってDockerfileに基づきビルド  
   - 作成されたコンテナイメージはGoogle Container Registryにアップロードされる  
   - ビルド時間は約1分程度  
4. **Cloud Runへのデプロイ**  
   - Google Cloud ConsoleのContainer Registry画面から対象のイメージを選択し、Cloud Runへデプロイ  
   - サービス名やリージョンを設定して作成  
5. **動作確認**  
   - 発行されたURLにアクセスし、Go言語で作成したシンプルなHelloWorld Webアプリが動作していることを確認  

## 補足  
- この手順はCloud Shellだけでなく、PCの開発環境でも同様に実行可能  
- Cloud Runに限らず、Kubernetes EngineやCompute Engineへのデプロイも可能  
- 実際はコマンド操作でデプロイまで自動化可能だが、今回はデプロイはコンソールから手動実施  

---

## まとめ  
- 開発者が作成したコードをビルドし、コンテナ化  
- コンテナイメージをレジストリーにプッシュ  
- Cloud Runにデプロイし、サービスとして公開  
- コードからCloud Runへの一連の流れを理解できる内容

# 小テスト16: CloudRun

---

## 問題例（サンプル）

1. **Cloud Runの特徴は何ですか？**  
   - サーバーレスのコンテナ実行環境  
   - 自動スケーリング対応  
   - 使った分だけの従量課金制  

2. **Cloud Runでデプロイできる単位は何ですか？**  
   - コンテナ単位  

3. **Cloud RunとCloud Functionsの主な違いは？**  
   - Cloud Runはコンテナ単位のデプロイ、Cloud Functionsは関数単位  
   - Cloud Runは複数の言語やフレームワークを自由に使える  

4. **Cloud Runの料金体系のポイントを答えよ。**  
   - CPU・メモリ・リクエスト数・ネットワークに基づく従量課金  
   - 無料枠あり  

5. **Cloud Runのスケーリングの仕組みについて説明せよ。**  
   - リクエストに応じてインスタンス数を自動的に増減する  
   - 最小0から最大は設定可能  

---

## ポイントまとめ

- **Cloud Runはフルマネージドなサーバーレスコンテナ実行環境。**
- **多様な言語・フレームワークのコンテナを実行可能。**
- **自動スケーリングにより、負荷に応じて柔軟にリソースを調整。**
- **使った分だけ課金され、無料枠も存在。**
- **Google Cloud内の各種サービスと連携しやすい。**

---

※ 具体的な試験問題や解答例は、授業資料や公式ドキュメントを参考に作成してください。

